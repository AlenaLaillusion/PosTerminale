# POS Terminale

Проект состоит из двух частей:
- **pos-server** — серверная часть, обрабатывающая запросы.
- **app (Android)** — клиентское приложение, взаимодействующее с сервером.

---
# Инструкция по настройке и запуску проекта

##  1.Создание RSA-ключей
Перейдите в корень pos-server через Git Bash:
```bash
cd <your_path>/posTerminale/pos-server
```
В папке pos-server необходимо создать и перейти в папку с названием `keys`:
```bash
mkdir keys
cd keys
ls -la     // убедиться, что ты в нужной папке
```
**!Фактическое расположение директории keys зависит от working directory запускаемого исполняемого файла pos-server!**

Для генерации приватного ключа выполните команду:
```bash
openssl genpkey -algorithm RSA -out private_key.pem -pkeyopt rsa_keygen_bits:2048
```
При необходимости можно просмотреть содержимое приватного ключа:
```bash
cat private_key.pem
```

Для получения публичного ключа из приватного выполните команду:
```bash
openssl rsa -pubout -in private_key.pem -out public_key.pem
```
После выполнения этих команд оба ключа будут находиться в папке keys.
Публичный ключ public_key.pem необходимо переместить в каталог: app/src/main/res/raw
```bash
mv public_key.pem ../../app/src/main/res/raw/public_key.pem
```


##  2.Настройка IP-адресов для взаимодействия Android-клиента и сервера

Если используется Android-эмулятор, подключение к локальному серверу осуществляется по адресу:
`10.0.2.2:8080`

Если используется реальное Android-устройство, подключённое по Wi-Fi, необходимо указать IP-адрес компьютера, например:
`192.168.1.10:5000`

где `192.168.1.10` — это IP вашего ПК (его можно узнать с помощью команды ipconfig в терминале Windows).

Для изменения IP-адреса или порта в Android-приложении откройте файл: app/build.gradle (Module: app)
и внесите нужные параметры подключения.

Чтобы изменить порт в серверной части проекта, откройте файл:
pos-server/src/main/java/com/example/util/Config.kt
и замените значение порта на нужное.


##  3.Запуск сервера (pos-server)

Для запуска сервера откройте Git Bash и перейдите в корень проекта:
```bash
cd /d/EDI/EDI/learning/posTerminale
```

Если вы запускаете сервер впервые, сделайте файл gradlew исполняемым:
```bash
chmod +x gradlew
```

После этого запустите сервер:
```bash
./gradlew :pos-server:run
```

При успешном запуске вы увидите сообщение вида:
`Server started on port 5000`

или можно запустить через IDEA, откройте файл: pos-server/src/main/java/com/example/main.kt
и нажмите кнопку Run на верхней панели.
**Убедитесь перед запуском, что Working Directory указывает на директорию pos-server (Run Configuretion)** 

##  4.Сборка и запуск Android-приложения

После запуска сервера можно собрать и запустить Android-приложение.
Для этого откройте проект в Android Studio, убедитесь, что IP-адрес и порт указаны корректно в коде (в зависимости от того, используется эмулятор или реальное устройство), и нажмите кнопку Run(app), чтобы запустить приложение.

После запуска приложение должно успешно подключиться к серверу и начать обмен данными.

##  5.Тестирование
# В проект добавлены юнит-тесты и интеграционные тесты, все они успешно выполнены.

## 6. Пример бинарного пакета (hexdump)

После генерации и отправки транзакции клиент формирует бинарный пакет `packet.bin`,
который содержит зашифрованные данные операции (PAN карты, сумма, UUID транзакции и т.д.)
в формате TLV, зашифрованные с использованием AES-GCM и RSA-OAEP.

Файл сохраняется в директории внутреннего хранилища приложения:
/data/data/com.example.posterminale/files/packet.bin

Для отладки он может быть извлечён с устройства через **Device File Explorer** или **adb** сохранен в директорию (например проекта) и просмотрен в виде HEX:
```bash
# в PowerShell
Format-Hex packet.bin
```
Пример ответа:
`
00000000   01 01 01 90 1C E9 C4 09 96 DA 1D 7E E7 B3 39 35  ....éÄ.Ú.~ç³95
00000010   34 D1 74 04 0F 45 D6 8B A1 D2 73 02 9C FF FA F7  4Ñt..EÖ¡Òs..ú÷
00000020   BD 14 42 C4 56 0C FF 3E 14 4D B3 58 3D 70 0F 8C  ½.BÄV..>.M³X=p.
00000030   48 BC 40 D0 99 14 87 CC 58 51 69 5F 82 65 DE BF  H¼@Ð.ÌXQi_eÞ¿
00000040   43 BD C4 DE D9 3D A1 95 98 52 45 94 AB 96 92 76  C½ÄÞÙ=¡RE«v
00000050   4D 4E 8B 4B AF 6F D1 0C BB 6F 9E 5F BF 85 FC 11  MNK¯oÑ.»o_¿ü.
00000060   F5 33 0A 8B 3B 19 82 00 7F 8E 32 05 C7 15 6F 84  õ3.;..2.Ç.o
00000070   60 92 90 7F 4D D7 5F 74 FF 9A 77 3C E6 6E F2 C4  `M×_t.w<ænòÄ
00000080   CA 8F 31 71 64 DD BD A1 4A 73 45 B5 1C 07 53 29  Ê1qdÝ½¡JsEµ..S)
00000090   F4 7A 1F 41 A3 06 D0 0B 0F 37 68 5A 1A 60 CC E9  ôz.A£.Ð..7hZ.`Ìé
000000A0   63 9A 2C A4 93 62 5B 19 20 CB B0 B3 E9 F3 C1 89  c,¤b[. Ë°³éóÁ
000000B0   0A C3 36 F7 EE BE 8D BE 8B C1 C6 F9 98 33 E1 EE  .Ã6÷î¾¾ÁÆù3áî
000000C0   BA 02 98 54 CE E9 8B 14 B3 DA CF 46 A2 E1 7D F4  º.TÎé.³ÚÏF¢á}ô
000000D0   E7 4D 3D 12 6E C1 15 EC 37 A0 0E 05 19 85 1F 1E  çM=.nÁ.ì7 .....
000000E0   FD 8E B4 A9 47 A7 52 71 F2 6A 24 E7 D5 E7 62 B2  ý´©G§Rqòj$çÕçb²
000000F0   2E C7 CA 18 19 B7 57 B2 C8 C2 45 58 5B 5B 25 8D  .ÇÊ..·W²ÈÂEX[[%
00000100   A1 F7 06 3F AB 30 DB 85 83 78 D3 09 29 BD F4 FD  ¡÷.?«0ÛxÓ.)½ôý
00000110   7D 09 C8 10 15 96 6B F5 C9 D1 94 E5 C7 AF D5 C7  }.È..kõÉÑåÇ¯ÕÇ
00000120   B7 E1 05 1E CA 96 27 87 6B AD DC C5 15 15 6B 05  ·á..Ê'k­ÜÅ..k.
00000130   73 4D 60 3B 17 84 CE B9 CC 99 89 E6 C8 73 D7 23  sM`;.Î¹ÌæÈs×#
00000140   2B D5 C8 75 AD 32 4F ED 67 8B 69 75 3A 06 2A 48  +ÕÈu­2Oígiu:.*H
00000150   3B 3E 5F 88 26 09 51 AC 90 ED 2A F2 E6 B6 D6 3F  ;>_&.Q¬í*òæ¶Ö?
00000160   DC 95 BD 8A CD 80 4F F9 E3 B9 21 B0 35 B6 1B 83  Ü½ÍOùã¹!°5¶.
00000170   8F C0 FE B1 60 22 7D C3 2B 23 06 F1 A6 9D F6 5E  Àþ±`"}Ã+#.ñ¦ö^
00000180   AB 3D 16 59 E0 CE 5C D3 49 5F BE 90 9A 94 2F 4C  «=.YàÎ\ÓI_¾/L
`